<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Sidebar</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="p-8">
        <h1 class="text-2xl font-bold mb-4">Test de la fonction updateSidebarActiveStates</h1>
        
        <!-- Simulation du sidebar -->
        <nav class="bg-gray-800 p-4 rounded-lg">
            <div class="space-y-2">
                <a href="/dashboard" data-sidebar-link class="flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white transition-colors duration-200">
                    <span class="font-medium">Dashboard</span>
                </a>
                <a href="/clients" data-sidebar-link class="flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white transition-colors duration-200">
                    <span class="font-medium">Clients</span>
                </a>
                <a href="/agents/ranking" data-sidebar-link class="flex items-center px-4 py-3 rounded-lg bg-gradient-to-r from-blue-600 to-yellow-500 text-white transition-colors duration-200">
                    <span class="font-medium">Classement</span>
                </a>
                <a href="/monthly-reports" data-sidebar-link class="flex items-center px-4 py-3 rounded-lg bg-gradient-to-r from-blue-600 to-yellow-500 text-white transition-colors duration-200">
                    <span class="font-medium">Rapports Mensuels</span>
                </a>
            </div>
        </nav>
        
        <div class="mt-6 space-y-2">
            <button onclick="testUpdate('/dashboard')" class="px-4 py-2 bg-blue-500 text-white rounded">Test Dashboard</button>
            <button onclick="testUpdate('/clients')" class="px-4 py-2 bg-green-500 text-white rounded">Test Clients</button>
            <button onclick="testUpdate('/agents/ranking')" class="px-4 py-2 bg-purple-500 text-white rounded">Test Classement</button>
            <button onclick="testUpdate('/monthly-reports')" class="px-4 py-2 bg-red-500 text-white rounded">Test Rapports</button>
        </div>
        
        <div id="log" class="mt-6 p-4 bg-white rounded border"></div>
    </div>

    <script>
        // Fonction corrigée
        function updateSidebarActiveStates(currentUrl) {
            console.log('Mise à jour pour URL:', currentUrl);
            
            // Réinitialiser tous les liens du sidebar
            const allSidebarLinks = document.querySelectorAll('nav a');
            allSidebarLinks.forEach(link => {
                // Supprimer les classes actives
                link.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-yellow-500', 'text-white');
                // Ajouter les classes inactives
                if (!link.classList.contains('text-gray-300')) {
                    link.classList.add('text-gray-300', 'hover:bg-gray-700', 'hover:text-white');
                }
            });
            
            // Trouver et activer le bon lien
            const sidebarLinks = document.querySelectorAll('[data-sidebar-link]');
            sidebarLinks.forEach(link => {
                const href = link.getAttribute('href');
                const linkPath = new URL(href, window.location.origin).pathname;
                const currentPath = new URL(currentUrl, window.location.origin).pathname;
                
                console.log('Comparaison:', currentPath, 'vs', linkPath);
                
                // Vérifier si c'est le lien actuel
                if (currentPath === linkPath || currentPath.startsWith(linkPath + '/')) {
                    console.log('Activation du lien:', href);
                    // Supprimer les classes inactives
                    link.classList.remove('text-gray-300', 'hover:bg-gray-700', 'hover:text-white');
                    // Ajouter les classes actives
                    link.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-yellow-500', 'text-white');
                }
            });
        }

        function testUpdate(url) {
            const log = document.getElementById('log');
            log.innerHTML = '<h3>Test pour: ' + url + '</h3>';
            updateSidebarActiveStates(window.location.origin + url);
            
            // Afficher l'état actuel
            const activeLinks = document.querySelectorAll('.bg-gradient-to-r');
            log.innerHTML += '<p>Liens actifs: ' + activeLinks.length + '</p>';
            activeLinks.forEach(link => {
                log.innerHTML += '<p>- ' + link.querySelector('span').textContent + '</p>';
            });
        }

        // Test initial
        console.log('Page chargée, test de la fonction...');
    </script>
</body>
</html>
